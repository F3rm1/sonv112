// ============================================================
// scoring.js â€” ĞŸĞ¾Ğ´ÑÑ‡Ñ‘Ñ‚, Ğ¸Ğ½Ñ‚ĞµÑ€Ğ¿Ñ€ĞµÑ‚Ğ°Ñ†Ğ¸Ñ, Ñ„Ğ»Ğ°Ğ³Ğ¸
// ============================================================

// ------------------------------------------------------------
// 1. ĞŸĞĞ”Ğ¡Ğ§ĞĞ¢ Ğ‘ĞĞ›Ğ›ĞĞ’
// ------------------------------------------------------------

function calculateResults(answers) {
  const results = {
    scales: {},
    validity: null,
    interpretation: null,
    flags: [],
    recommendations: []
  };

  // ĞŸĞ¾Ğ´ÑÑ‡Ñ‘Ñ‚ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ ÑˆĞºĞ°Ğ»Ñ‹
  for (const [key, scale] of Object.entries(SCALES)) {
    const sum = scale.questions.reduce((acc, qId) => {
      return acc + (answers[qId] !== undefined ? answers[qId] : 0);
    }, 0);

    const percentage = Math.round((sum / scale.maxScore) * 100);
    const zone = getZone(percentage, scale);

    results.scales[key] = {
      key: key,
      name: scale.name,
      shortName: scale.shortName,
      category: scale.category,
      sum: sum,
      max: scale.maxScore,
      percentage: percentage,
      zone: zone,
      description: scale.description,
      basis: scale.basis,
      subscales: {},
      questionDetails: getQuestionDetails(scale.questions, answers)
    };

    // Ğ¡ÑƒĞ±-ÑˆĞºĞ°Ğ»Ñ‹
    if (scale.subscales) {
      for (const [subKey, sub] of Object.entries(scale.subscales)) {
        const subSum = sub.questions.reduce((acc, qId) => {
          return acc + (answers[qId] !== undefined ? answers[qId] : 0);
        }, 0);
        const subPct = Math.round((subSum / sub.maxScore) * 100);

        results.scales[key].subscales[subKey] = {
          key: subKey,
          name: sub.name,
          shortName: sub.shortName,
          sum: subSum,
          max: sub.maxScore,
          percentage: subPct,
          zone: getZoneByPercent(subPct),
          description: sub.description
        };
      }
    }
  }

  // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ¾ÑÑ‚Ğ¾Ğ²ĞµÑ€Ğ½Ğ¾ÑÑ‚Ğ¸
  results.validity = checkValidity(results.scales);

  // Ğ˜Ğ½Ñ‚ĞµÑ€Ğ¿Ñ€ĞµÑ‚Ğ°Ñ†Ğ¸Ñ
  results.interpretation = generateInterpretation(results.scales);

  // Ğ¤Ğ»Ğ°Ğ³Ğ¸
  results.flags = generateFlags(results.scales);

  // Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸
  results.recommendations = generateRecommendations(results);

  return results;
}

// ------------------------------------------------------------
// 2. ĞĞŸĞ Ğ•Ğ”Ğ•Ğ›Ğ•ĞĞ˜Ğ• Ğ—ĞĞ
// ------------------------------------------------------------

function getZone(percentage, scale) {
  // Ğ”Ğ»Ñ Ğ²ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… ÑˆĞºĞ°Ğ» â€” ÑĞ²Ğ¾Ğ¸ Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ¸
  if (scale.thresholds) {
    const sum = Math.round(percentage * scale.maxScore / 100);
    if (sum <= scale.thresholds.low.max) {
      return {
        key: "low",
        label: scale.thresholds.low.label,
        color: scale.thresholds.low.color,
        icon: scale.thresholds.low.icon
      };
    } else if (sum <= scale.thresholds.mid.max) {
      return {
        key: "mid",
        label: scale.thresholds.mid.label,
        color: scale.thresholds.mid.color,
        icon: scale.thresholds.mid.icon
      };
    } else {
      return {
        key: "high",
        label: scale.thresholds.high.label,
        color: scale.thresholds.high.color,
        icon: scale.thresholds.high.icon
      };
    }
  }

  // Ğ”Ğ»Ñ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ñ… ÑˆĞºĞ°Ğ» â€” ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğµ Ğ·Ğ¾Ğ½Ñ‹
  return getZoneByPercent(percentage);
}

function getZoneByPercent(pct) {
  if (pct >= 80) return { key: "red", ...ZONES.red };
  if (pct >= 60) return { key: "orange", ...ZONES.orange };
  if (pct >= 40) return { key: "yellow", ...ZONES.yellow };
  return { key: "green", ...ZONES.green };
}

// ------------------------------------------------------------
// 3. Ğ”Ğ•Ğ¢ĞĞ›Ğ˜ ĞŸĞ Ğ’ĞĞŸĞ ĞĞ¡ĞĞœ (Ğ´Ğ»Ñ Ñ€Ğ°ÑĞºÑ€Ñ‹Ğ²Ğ°ÑÑ‰Ğ¸Ñ…ÑÑ Ğ±Ğ»Ğ¾ĞºĞ¾Ğ²)
// ------------------------------------------------------------

function getQuestionDetails(questionIds, answers) {
  return questionIds.map(qId => {
    const question = QUESTIONS.find(q => q.id === qId);
    return {
      id: qId,
      text: question ? question.text : "",
      answer: answers[qId] !== undefined ? answers[qId] : 0
    };
  }).sort((a, b) => b.answer - a.answer); // ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ° ÑĞ°Ğ¼Ñ‹Ğµ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğµ
}

// ------------------------------------------------------------
// 4. ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ”ĞĞ¡Ğ¢ĞĞ’Ğ•Ğ ĞĞĞ¡Ğ¢Ğ˜
// ------------------------------------------------------------

function checkValidity(scales) {
  const result = {
    isValid: true,
    warnings: []
  };

  // Ğ¨ĞºĞ°Ğ»Ğ° L â€” ÑĞ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¶ĞµĞ»Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ
  const L = scales.L;
  if (L.sum >= 13) {
    result.isValid = false;
    result.warnings.push({
      type: "critical",
      icon: "ğŸš«",
      title: "Ğ”Ğ¾ÑÑ‚Ğ¾Ğ²ĞµÑ€Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾Ğ´ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ¼",
      text: `Ğ‘Ğ°Ğ»Ğ» Ğ¿Ğ¾ ÑˆĞºĞ°Ğ»Ğµ ÑĞ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¶ĞµĞ»Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸: ${L.sum}/20. Ğ­Ñ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¾Ğ·Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ Ñ‚ĞµĞ½Ğ´ĞµĞ½Ñ†Ğ¸Ñ Ğº Â«Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼Â» Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°Ğ¼, 
        Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½ÑƒÑ ÑĞ°Ğ¼Ğ¾Ñ€ĞµÑ„Ğ»ĞµĞºÑĞ¸Ñ Ğ¸Ğ»Ğ¸ Ğ½ĞµĞ²Ğ½Ğ¸Ğ¼Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ. Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ñ… ÑˆĞºĞ°Ğ» Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ·Ğ°Ğ½Ğ¸Ğ¶ĞµĞ½Ñ‹. 
        Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğµ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ñ Ğ°ĞºÑ†ĞµĞ½Ñ‚Ğ¾Ğ¼ Ğ½Ğ° Ñ‡ĞµÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¸Ğ»Ğ¸ ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²ÑŒÑ.`
    });
  } else if (L.sum >= 8) {
    result.warnings.push({
      type: "moderate",
      icon: "âš ï¸",
      title: "Ğ£Ğ¼ĞµÑ€ĞµĞ½Ğ½Ğ°Ñ ÑĞ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¶ĞµĞ»Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ",
      text: `Ğ‘Ğ°Ğ»Ğ» Ğ¿Ğ¾ ÑˆĞºĞ°Ğ»Ğµ ÑĞ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¶ĞµĞ»Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸: ${L.sum}/20. Ğ ĞµĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ Ñ‡ĞµÑ€Ñ‚ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ²Ñ‹ÑˆĞµ, 
        Ñ‡ĞµĞ¼ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ¾. ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ğµ: Ñƒ Ğ»ÑĞ´ĞµĞ¹ Ñ Ğ ĞĞ¡-Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ĞµĞ¼ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ğ±Ğ°Ğ»Ğ» Ğ¿Ğ¾ ÑÑ‚Ğ¾Ğ¹ ÑˆĞºĞ°Ğ»Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¾Ñ‚Ñ€Ğ°Ğ¶Ğ°Ñ‚ÑŒ Ğ½Ğµ ÑĞ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½ÑƒÑ 
        Ğ¶ĞµĞ»Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ, Ğ° Ğ±ÑƒĞºĞ²Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ²Ğ¾ÑĞ¿Ñ€Ğ¸ÑÑ‚Ğ¸Ğµ ÑƒÑ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğ¹ Ğ¸ Ğ¸ÑĞºÑ€ĞµĞ½Ğ½ÑÑ ÑĞ°Ğ¼Ğ¾Ğ¾Ñ†ĞµĞ½ĞºÑƒ ĞºĞ°Ğº Â«Ñ‡ĞµÑÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºĞ°Â».`
    });
  }

  // Ğ¨ĞºĞ°Ğ»Ğ° M â€” Ğ°Ñ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ğ½
  const M = scales.M;
  if (M.sum >= 15) {
    result.warnings.push({
      type: "critical",
      icon: "ğŸ”´",
      title: "Ğ—Ğ½Ğ°Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ²Ğ»Ğ¸ÑĞ½Ğ¸Ğµ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ",
      text: `Ğ‘Ğ°Ğ»Ğ» Ğ¿Ğ¾ ÑˆĞºĞ°Ğ»Ğµ Ñ‚Ñ€ĞµĞ²Ğ¾Ğ³Ğ¸/Ğ´ĞµĞ¿Ñ€ĞµÑÑĞ¸Ğ¸: ${M.sum}/24. Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ñ… ÑˆĞºĞ°Ğ» Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ Ğ¸ÑĞºĞ°Ğ¶ĞµĞ½Ñ‹ 
        Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¼ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸ĞµĞ¼. Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ Ğ² Ğ¿ĞµÑ€Ğ²ÑƒÑ Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒÑÑ Ğº ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸ÑÑ‚Ñƒ Ğ¿Ğ¾ Ğ¿Ğ¾Ğ²Ğ¾Ğ´Ñƒ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ 
        ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ, Ğ° Ğ¾Ñ†ĞµĞ½ĞºÑƒ Ğ½ĞµĞ¹Ñ€Ğ¾Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¿Ñ€Ğ¾Ğ²Ğ¾Ğ´Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ÑĞ»Ğµ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸.`
    });
  } else if (M.sum >= 9) {
    result.warnings.push({
      type: "moderate",
      icon: "âš ï¸",
      title: "Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾Ğµ Ğ²Ğ»Ğ¸ÑĞ½Ğ¸Ğµ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ",
      text: `Ğ‘Ğ°Ğ»Ğ» Ğ¿Ğ¾ ÑˆĞºĞ°Ğ»Ğµ Ñ‚Ñ€ĞµĞ²Ğ¾Ğ³Ğ¸/Ğ´ĞµĞ¿Ñ€ĞµÑÑĞ¸Ğ¸: ${M.sum}/24. ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ ÑÑ‚Ğ¾ ĞºĞ°ÑĞ°ĞµÑ‚ÑÑ ÑˆĞºĞ°Ğ» Ğ½ĞµĞ²Ğ½Ğ¸Ğ¼Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ğ¸ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ 
        Ğ´Ğ¸ÑÑ€ĞµĞ³ÑƒĞ»ÑÑ†Ğ¸Ğ¸ â€” Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ Ğ½Ğ¸Ğ¼ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ñ‡Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ¾Ñ‚Ñ€Ğ°Ğ¶Ğ°Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ, Ğ° Ğ½Ğµ ÑƒÑÑ‚Ğ¾Ğ¹Ñ‡Ğ¸Ğ²ÑƒÑ Ğ½ĞµĞ¹Ñ€Ğ¾Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ.`
    });
  }

  return result;
}

// ------------------------------------------------------------
// 5. Ğ˜ĞĞ¢Ğ•Ğ ĞŸĞ Ğ•Ğ¢ĞĞ¦Ğ˜Ğ¯
// ------------------------------------------------------------

function generateInterpretation(scales) {
  const interp = {
    adhd: interpretADHD(scales),
    asd: interpretASD(scales),
    learning: interpretLearning(scales),
    comorbidity: interpretComorbidity(scales),
    summary: ""
  };

  interp.summary = generateSummary(interp, scales);
  return interp;
}

// --- Ğ¡Ğ”Ğ’Ğ“ ---

function interpretADHD(scales) {
  const A = scales.A;
  const B = scales.B;
  const C = scales.C;
  const result = {
    present: false,
    type: null,
    confidence: "low",
    title: "",
    text: "",
    details: []
  };

  const aZone = A.zone.key;
  const bZone = B.zone.key;

  // ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¸Ğ¿Ğ°
  if (isAboveThreshold(aZone) && isAboveThreshold(bZone)) {
    result.present = true;
    result.type = "combined";
    result.title = "Ğ¡Ğ”Ğ’Ğ“ â€” ĞšĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿";
    result.text = "ĞĞ±Ğ° Ğ´Ğ¾Ğ¼ĞµĞ½Ğ° Ğ¡Ğ”Ğ’Ğ“ â€” Ğ½ĞµĞ²Ğ½Ğ¸Ğ¼Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ¸ Ğ³Ğ¸Ğ¿ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ/Ğ¸Ğ¼Ğ¿ÑƒĞ»ÑŒÑĞ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ â€” Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ñ‹ Ğ²Ñ‹ÑˆĞµ Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ°. " +
      "Ğ­Ñ‚Ğ¾ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¹ Ğ¿Ñ€ĞµĞ·ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸ Ğ¡Ğ”Ğ’Ğ“ (DSM-5: 314.01 / F90.2).";
  } else if (isAboveThreshold(aZone) && !isAboveThreshold(bZone)) {
    result.present = true;
    result.type = "inattentive";
    result.title = "Ğ¡Ğ”Ğ’Ğ“ â€” ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ Ğ½ĞµĞ²Ğ½Ğ¸Ğ¼Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿";
    result.text = "Ğ”Ğ¾Ğ¼ĞµĞ½ Ğ½ĞµĞ²Ğ½Ğ¸Ğ¼Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾, Ğ³Ğ¸Ğ¿ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ/Ğ¸Ğ¼Ğ¿ÑƒĞ»ÑŒÑĞ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ â€” Ğ½Ğ¸Ğ¶Ğµ Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ°. " +
      "Ğ­Ñ‚Ğ¾ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ¿Ñ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ Ğ½ĞµĞ²Ğ½Ğ¸Ğ¼Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ¿Ñ€ĞµĞ·ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸ Ğ¡Ğ”Ğ’Ğ“ (DSM-5: 314.00 / F90.0).";
  } else if (!isAboveThreshold(aZone) && isAboveThreshold(bZone)) {
    result.present = true;
    result.type = "hyperactive";
    result.title = "Ğ¡Ğ”Ğ’Ğ“ â€” ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ Ğ³Ğ¸Ğ¿ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾-Ğ¸Ğ¼Ğ¿ÑƒĞ»ÑŒÑĞ¸Ğ²Ğ½Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿";
    result.text = "Ğ”Ğ¾Ğ¼ĞµĞ½ Ğ³Ğ¸Ğ¿ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸/Ğ¸Ğ¼Ğ¿ÑƒĞ»ÑŒÑĞ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾, Ğ½ĞµĞ²Ğ½Ğ¸Ğ¼Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ â€” Ğ½Ğ¸Ğ¶Ğµ Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ°. " +
      "Ğ­Ñ‚Ğ¾ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ¿Ñ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ Ğ³Ğ¸Ğ¿ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾-Ğ¸Ğ¼Ğ¿ÑƒĞ»ÑŒÑĞ¸Ğ²Ğ½Ğ¾Ğ¹ Ğ¿Ñ€ĞµĞ·ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸ (DSM-5: 314.01). " +
      "Ğ”Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ Ñ€ĞµĞ´ĞºĞ¾ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ğ°ĞµÑ‚ÑÑ Ñƒ Ğ²Ğ·Ñ€Ğ¾ÑĞ»Ñ‹Ñ… Ğ² Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¼ Ğ²Ğ¸Ğ´Ğµ.";
  } else if (aZone === "yellow" || bZone === "yellow") {
    result.present = false;
    result.type = "subthreshold";
    result.title = "Ğ¡Ğ”Ğ’Ğ“ â€” Ğ¡ÑƒĞ±ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ‡ĞµÑ€Ñ‚Ñ‹";
    result.text = "ĞĞµĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ñ‡ĞµÑ€Ñ‚Ñ‹ Ğ¡Ğ”Ğ’Ğ“ Ğ¿Ñ€Ğ¸ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ Ğ² ÑƒĞ¼ĞµÑ€ĞµĞ½Ğ½Ğ¾Ğ¹ ÑÑ‚ĞµĞ¿ĞµĞ½Ğ¸, Ğ½Ğ¾ Ğ½Ğµ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ³Ğ°ÑÑ‚ Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ°, " +
      "Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ½Ğ¾Ğ³Ğ¾ Ğ´Ğ»Ñ ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ğ¼Ğ¾Ğ³Ğ¾ Ğ¡Ğ”Ğ’Ğ“. Ğ­Ñ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¾Ñ‚Ñ€Ğ°Ğ¶Ğ°Ñ‚ÑŒ Ğ¼ÑĞ³ĞºĞ¸Ğµ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ " +
      "Ğ¸Ğ»Ğ¸ Ñ‡Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½ÑƒÑ ĞºĞ¾Ğ¼Ğ¿ĞµĞ½ÑĞ°Ñ†Ğ¸Ñ.";
  } else {
    result.title = "Ğ¡Ğ”Ğ’Ğ“ â€” ĞĞµ Ğ²Ñ‹ÑĞ²Ğ»ĞµĞ½Ğ¾";
    result.text = "Ğ§ĞµÑ€Ñ‚Ñ‹ Ğ¡Ğ”Ğ’Ğ“ Ğ½Ğµ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ñ‹ Ğ¸Ğ»Ğ¸ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ñ‹ ÑĞ»Ğ°Ğ±Ğ¾.";
    return result;
  }

  // CDS
  if (A.subscales.CDS) {
    const cds = A.subscales.CDS;
    if (cds.percentage >= 60) {
      result.details.push({
        title: "ĞšĞ¾Ğ³Ğ½Ğ¸Ñ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ñ€Ğ°ÑÑ„Ğ¾ĞºÑƒÑĞ¸Ñ€Ğ¾Ğ²ĞºĞ° (CDS)",
        text: `Ğ’Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ‹Ğ¹ CDS-Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½ (${cds.percentage}%): Â«Ñ‚ÑƒĞ¼Ğ°Ğ½ Ğ² Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞµÂ», Ğ¼ĞµÑ‡Ñ‚Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ, ` +
          `Ğ´Ğ¸ÑÑĞ¾Ñ†Ğ¸Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¿Ğ¾Ğ´Ğ¾Ğ±Ğ½Ñ‹Ğµ ÑĞ¿Ğ¸Ğ·Ğ¾Ğ´Ñ‹ Â«Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸ÑÂ». ` +
          (isAboveThreshold(bZone) ?
            "ĞŸÑ€Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ²Ñ‹ÑĞ¾ĞºĞ¾Ğ¹ Ğ³Ğ¸Ğ¿ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ ÑÑ‚Ğ¾ Ğ¿Ğ°Ñ€Ğ°Ğ´Ğ¾ĞºÑĞ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾Ñ‡ĞµÑ‚Ğ°Ğ½Ğ¸Ğµ â€” Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ " +
            "Â«Ğ¼Ğ¾Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Â» Ğ¸ Â«Ğ² Ñ‚ÑƒĞ¼Ğ°Ğ½ĞµÂ», Ñ‡Ñ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ñ€Ğ¾ÑĞ²Ğ»ÑÑ‚ÑŒÑÑ ĞºĞ°Ğº Ñ…Ğ°Ğ¾Ñ‚Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğ±ĞµĞ· Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ." :
            "Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ½ĞµĞ²Ğ½Ğ¸Ğ¼Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° Ğ¡Ğ”Ğ’Ğ“.")
      });
    }
  }

  // Ğ­Ğ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ´Ğ¸ÑÑ€ĞµĞ³ÑƒĞ»ÑÑ†Ğ¸Ñ
  if (C.zone.key === "orange" || C.zone.key === "red") {
    result.details.push({
      title: "Ğ­Ğ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ´Ğ¸ÑÑ€ĞµĞ³ÑƒĞ»ÑÑ†Ğ¸Ñ",
      text: `Ğ—Ğ½Ğ°Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ (${C.percentage}%). Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğµ, Ğ¸Ğ½Ñ‚ĞµĞ½ÑĞ¸Ğ²Ğ½Ñ‹Ğµ, Ğ¿Ğ»Ğ¾Ñ…Ğ¾ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğµ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¸. ` +
        "Ğ­Ğ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¼ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ¼ ÑÑƒĞ±ÑŠĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ ÑÑ‚Ñ€Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ."
    });
  }

  // RSD
  if (C.subscales.RSD && C.subscales.RSD.percentage >= 60) {
    const rsd = C.subscales.RSD;
    result.details.push({
      title: "Ğ§ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğº Ğ¾Ñ‚Ğ²ĞµÑ€Ğ¶ĞµĞ½Ğ¸Ñ (RSD)",
      text: `Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ (${rsd.percentage}%). ĞšÑ€Ğ¸Ñ‚Ğ¸ĞºĞ° Ğ¸ Ğ¾Ñ‰ÑƒÑ‰ĞµĞ½Ğ¸Ğµ Ğ½ĞµĞ¾Ğ´Ğ¾Ğ±Ñ€ĞµĞ½Ğ¸Ñ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ ` +
        "Ğ¸Ğ½Ñ‚ĞµĞ½ÑĞ¸Ğ²Ğ½ÑƒÑ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½ÑƒÑ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ. Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ¡Ğ”Ğ’Ğ“, Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ Ñ‡Ğ°ÑÑ‚Ğ¾ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ğ°ĞµÑ‚ÑÑ Ñƒ Ğ¶ĞµĞ½Ñ‰Ğ¸Ğ½."
    });
  }

  // Ğ¡Ğ”Ğ’Ğ“-Ñ‚Ñ€ĞµĞ²Ğ¾Ğ³Ğ°
  if (C.subscales.ADHD_ANX && C.subscales.ADHD_ANX.percentage >= 60) {
    const anx = C.subscales.ADHD_ANX;
    const generalAnxiety = scales.M.sum;
    result.details.push({
      title: "Ğ¡Ğ”Ğ’Ğ“-Ğ¾Ğ±ÑƒÑĞ»Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ğ°Ñ Ñ‚Ñ€ĞµĞ²Ğ¾Ğ³Ğ°",
      text: `Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ (${anx.percentage}%). ` +
        (generalAnxiety <= 8 ?
          "ĞŸÑ€Ğ¸ ÑÑ‚Ğ¾Ğ¼ Ğ¾Ğ±Ñ‰Ğ°Ñ Ñ‚Ñ€ĞµĞ²Ğ¾Ğ³Ğ° ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ° â€” ÑÑ‚Ğ¾ ÑƒĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ½Ğ° Ñ‚Ğ¾, Ñ‡Ñ‚Ğ¾ Ñ‚Ñ€ĞµĞ²Ğ¾Ğ³Ğ° ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑĞ²ÑĞ·Ğ°Ğ½Ğ° " +
          "Ñ Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğ¼ Ğ¡Ğ”Ğ’Ğ“ (Â«Ñ Ğ·Ğ½Ğ°Ñ, Ñ‡Ñ‚Ğ¾ Ğ·Ğ°Ğ±ÑƒĞ´Ñƒ, Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ¼Ñƒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑÑÂ»), Ğ° Ğ½Ğµ ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ¿ĞµÑ€Ğ²Ğ¸Ñ‡Ğ½Ñ‹Ğ¼ Ñ‚Ñ€ĞµĞ²Ğ¾Ğ¶Ğ½Ñ‹Ğ¼ Ñ€Ğ°ÑÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾Ğ¼." :
          "ĞĞ±Ñ‰Ğ°Ñ Ñ‚Ñ€ĞµĞ²Ğ¾Ğ³Ğ° Ñ‚Ğ°ĞºĞ¶Ğµ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ° â€” Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ Ğ´Ğ¸Ñ„Ñ„ĞµÑ€ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ°: " +
          "ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ»Ğ¸ Ñ‚Ñ€ĞµĞ²Ğ¾Ğ³Ğ° ÑĞ»ĞµĞ´ÑÑ‚Ğ²Ğ¸ĞµĞ¼ Ğ¡Ğ”Ğ’Ğ“ Ğ¸Ğ»Ğ¸ ÑĞ°Ğ¼Ğ¾ÑÑ‚Ğ¾ÑÑ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ Ñ€Ğ°ÑÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾Ğ¼.")
    });
  }

  // Ğ£Ğ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ
  if (result.present) {
    const kZone = scales.K.zone.key;
    const nSum = scales.N.sum;
    if (kZone === "high" && nSum >= 6) {
      result.confidence = "high";
    } else if (kZone === "mid" || nSum >= 6) {
      result.confidence = "moderate";
    } else {
      result.confidence = "low";
    }
  }

  return result;
}

// --- Ğ ĞĞ¡ ---

function interpretASD(scales) {
  const D = scales.D;
  const E = scales.E;
  const F = scales.F;
  const G = scales.G;
  const result = {
    present: false,
    confidence: "low",
    title: "",
    text: "",
    details: []
  };

  const dZone = D.zone.key;
  const eZone = E.zone.key;

  if (isAboveThreshold(dZone) && isAboveThreshold(eZone)) {
    result.present = true;
    result.title = "Ğ ĞĞ¡ â€” Ğ Ğ°ÑÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾ Ğ°ÑƒÑ‚Ğ¸ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ ÑĞ¿ĞµĞºÑ‚Ñ€Ğ°";
    result.text = `Ğ”ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ñ‹ Ğ² ÑĞ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ (${D.percentage}%) Ğ¸ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ½Ñ‹Ğµ/Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑÑÑ‰Ğ¸ĞµÑÑ ` +
      `Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ (${E.percentage}%) Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ñ‹ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾. ĞŸĞ¾ DSM-5 Ğ´Ğ»Ñ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾Ğ·Ğ° Ğ ĞĞ¡ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ ` +
      "Ğ¿Ñ€Ğ¸ÑÑƒÑ‚ÑÑ‚Ğ²Ğ¸Ğµ Ğ¾Ğ±Ğ¾Ğ¸Ñ… Ğ´Ğ¾Ğ¼ĞµĞ½Ğ¾Ğ² â€” Ğ¾Ğ±Ğ° Ğ²Ñ‹ÑˆĞµ Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ°.";
  } else if (isAboveThreshold(dZone) && !isAboveThreshold(eZone)) {
    result.present = false;
    result.title = "Ğ¢Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚Ğ¸ ÑĞ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸";
    result.text = `Ğ¢Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ² ÑĞ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ñ‹ (${D.percentage}%), Ğ½Ğ¾ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹/Ñ€Ğ¸Ğ³Ğ¸Ğ´Ğ½Ğ¾ÑÑ‚ÑŒ ` +
      `Ğ½Ğ¸Ğ¶Ğµ Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ° (${E.percentage}%). Ğ­Ñ‚Ğ¾ Ğ½Ğµ Ñ‚Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ ĞĞ¡. Ğ Ğ°ÑÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ: ÑĞ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ (Ğ¿Ñ€Ğ°Ğ³Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ) ` +
      "Ñ€Ğ°ÑÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ (DSM-5: 315.39), ÑĞ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½ÑƒÑ Ñ‚Ñ€ĞµĞ²Ğ¾Ğ³Ñƒ, Ğ¿Ğ¾ÑĞ»ĞµĞ´ÑÑ‚Ğ²Ğ¸Ñ Ñ‚Ñ€Ğ°Ğ²Ğ¼Ñ‹.";
  } else if (!isAboveThreshold(dZone) && isAboveThreshold(eZone)) {
    result.present = false;
    result.title = "Ğ’Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ±ĞµĞ· ÑĞ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚ĞµĞ¹";
    result.text = `ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹/Ñ€Ğ¸Ğ³Ğ¸Ğ´Ğ½Ğ¾ÑÑ‚ÑŒ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ñ‹ (${E.percentage}%), Ğ½Ğ¾ ÑĞ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ¸ĞºĞ°Ñ†Ğ¸Ñ ` +
      `Ğ½Ğ¸Ğ¶Ğµ Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ° (${D.percentage}%). Ğ­Ñ‚Ğ¾ Ğ½ĞµÑ‚Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ ĞĞ¡. Ğ Ğ°ÑÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ: ĞĞšĞ , Ñ‚Ñ€ĞµĞ²Ğ¾Ğ¶Ğ½Ğ¾Ğµ Ñ€Ğ°ÑÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾, ` +
      "Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ»Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚Ğ¸.";
  } else if (dZone === "yellow" || eZone === "yellow") {
    result.title = "Ğ ĞĞ¡ â€” Ğ¡ÑƒĞ±ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ‡ĞµÑ€Ñ‚Ñ‹";
    result.text = "ĞĞµĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ°ÑƒÑ‚Ğ¸ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ‡ĞµÑ€Ñ‚Ñ‹ Ğ¿Ñ€Ğ¸ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ Ğ² ÑƒĞ¼ĞµÑ€ĞµĞ½Ğ½Ğ¾Ğ¹ ÑÑ‚ĞµĞ¿ĞµĞ½Ğ¸, Ğ½Ğ¾ Ğ½Ğµ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ³Ğ°ÑÑ‚ " +
      "Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ° Ğ´Ğ»Ñ Ğ ĞĞ¡.";
  } else {
    result.title = "Ğ ĞĞ¡ â€” ĞĞµ Ğ²Ñ‹ÑĞ²Ğ»ĞµĞ½Ğ¾";
    result.text = "ĞÑƒÑ‚Ğ¸ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ‡ĞµÑ€Ñ‚Ñ‹ Ğ½Ğµ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ñ‹ Ğ¸Ğ»Ğ¸ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ñ‹ ÑĞ»Ğ°Ğ±Ğ¾.";
    return result;
  }

  // Ğ¡ĞµĞ½ÑĞ¾Ñ€Ğ¸ĞºĞ°
  if (F.zone.key === "orange" || F.zone.key === "red") {
    result.details.push({
      title: "Ğ¡ĞµĞ½ÑĞ¾Ñ€Ğ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°",
      text: `Ğ’Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ğ°Ñ ÑĞµĞ½ÑĞ¾Ñ€Ğ½Ğ°Ñ Ğ³Ğ¸Ğ¿ĞµÑ€-/Ğ³Ğ¸Ğ¿Ğ¾Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ (${F.percentage}%). ` +
        (result.present ?
          "ĞŸĞ¾Ğ´ĞºÑ€ĞµĞ¿Ğ»ÑĞµÑ‚ Ğ ĞĞ¡-Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ (ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ ĞºÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ñ B4 DSM-5)." :
          "Ğ¡ĞµĞ½ÑĞ¾Ñ€Ğ½Ñ‹Ğµ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ¿Ñ€Ğ¸ÑÑƒÑ‚ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¸ Ğ²Ğ½Ğµ Ğ ĞĞ¡.")
    });
  }

  // ĞšĞ°Ğ¼ÑƒÑ„Ğ»ÑĞ¶
  if (G.zone.key === "orange" || G.zone.key === "red") {
    result.details.push({
      title: "ĞšĞ°Ğ¼ÑƒÑ„Ğ»ÑĞ¶ / ĞœĞ°ÑĞºĞ¸Ğ½Ğ³",
      text: `Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ ĞºĞ°Ğ¼ÑƒÑ„Ğ»ÑĞ¶Ğ° (${G.percentage}%). Ğ’Ñ‹, Ğ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾, Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ»Ğ¸ Ğ¾Ğ±ÑˆĞ¸Ñ€Ğ½ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ ` +
        "Ğ¼Ğ°ÑĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ½ĞµĞ¹Ñ€Ğ¾Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ñ‡ĞµÑ€Ñ‚. Ğ­Ñ‚Ğ¾ Ğ¾Ğ·Ğ½Ğ°Ñ‡Ğ°ĞµÑ‚: (1) Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚ĞµĞ¹ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ " +
        "Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ²Ñ‹ÑˆĞµ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğ¹, (2) Ğ¼Ğ°ÑĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ¼ Ğ¸ÑÑ‚Ğ¾Ñ‰ĞµĞ½Ğ¸Ñ. " +
        "Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ¶ĞµĞ½Ñ‰Ğ¸Ğ½ Ğ¸ Ğ¿Ğ¾Ğ·Ğ´Ğ½Ğ¾ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ»ÑĞ´ĞµĞ¹."
    });
  }

  // Ğ£Ğ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ
  if (result.present) {
    const kZone = scales.K.zone.key;
    const nSum = scales.N.sum;
    const fHigh = F.zone.key === "orange" || F.zone.key === "red";
    if (kZone === "high" && nSum >= 6 && fHigh) {
      result.confidence = "high";
    } else if (kZone === "mid" || nSum >= 6) {
      result.confidence = "moderate";
    } else {
      result.confidence = "low";
    }
  }

  return result;
}

// --- Ğ Ğ°ÑÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ ---

function interpretLearning(scales) {
  const results = [];

  // Ğ”Ğ¸ÑĞ»ĞµĞºÑĞ¸Ñ
  const H = scales.H;
  if (isAboveThreshold(H.zone.key)) {
    results.push({
      type: "dyslexia",
      title: "Ğ”Ğ¸ÑĞ»ĞµĞºÑĞ¸Ñ",
      text: `Ğ¢Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚Ğ¸ Ñ Ñ‡Ñ‚ĞµĞ½Ğ¸ĞµĞ¼ Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¾Ğ¹ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ñ‹ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ (${H.percentage}%). ` +
        "Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ Ğ½ĞµĞ¹Ñ€Ğ¾Ğ¿ÑĞ¸Ñ…Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¾Ğ±ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ.",
      confidence: H.zone.key === "red" ? "high" : "moderate"
    });
  } else if (H.zone.key === "yellow") {
    results.push({
      type: "dyslexia",
      title: "Ğ”Ğ¸ÑĞ»ĞµĞºÑĞ¸Ñ â€” ÑÑƒĞ±ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ‡ĞµÑ€Ñ‚Ñ‹",
      text: `ĞĞµĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚Ğ¸ Ñ Ñ‡Ñ‚ĞµĞ½Ğ¸ĞµĞ¼/Ğ¿Ğ¸ÑÑŒĞ¼Ğ¾Ğ¼ (${H.percentage}%). ĞœĞ¾Ğ³ÑƒÑ‚ Ğ¾Ğ±ÑŠÑÑĞ½ÑÑ‚ÑŒÑÑ ` +
        "Ğ½ĞµĞ²Ğ½Ğ¸Ğ¼Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒÑ (Ğ¡Ğ”Ğ’Ğ“) Ğ¸Ğ»Ğ¸ ĞºĞ¾Ğ³Ğ½Ğ¸Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¹ Ñ€Ğ°ÑÑ„Ğ¾ĞºÑƒÑĞ¸Ñ€Ğ¾Ğ²ĞºĞ¾Ğ¹ (CDS).",
      confidence: "low"
    });
  }

  // Ğ”Ğ¸ÑĞºĞ°Ğ»ÑŒĞºÑƒĞ»Ğ¸Ñ
  const I = scales.I;
  if (isAboveThreshold(I.zone.key)) {
    results.push({
      type: "dyscalculia",
      title: "Ğ”Ğ¸ÑĞºĞ°Ğ»ÑŒĞºÑƒĞ»Ğ¸Ñ",
      text: `Ğ¢Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚Ğ¸ Ñ Ñ‡Ğ¸ÑĞ»Ğ°Ğ¼Ğ¸ Ğ¸ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ğ°Ğ¼Ğ¸ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ñ‹ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ (${I.percentage}%). ` +
        "Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ Ğ½ĞµĞ¹Ñ€Ğ¾Ğ¿ÑĞ¸Ñ…Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¾Ğ±ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ.",
      confidence: I.zone.key === "red" ? "high" : "moderate"
    });
  } else if (I.zone.key === "yellow") {
    results.push({
      type: "dyscalculia",
      title: "Ğ”Ğ¸ÑĞºĞ°Ğ»ÑŒĞºÑƒĞ»Ğ¸Ñ â€” ÑÑƒĞ±ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ‡ĞµÑ€Ñ‚Ñ‹",
      text: `ĞÑ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚Ğ¸ Ñ Ñ‡Ğ¸ÑĞ»Ğ°Ğ¼Ğ¸ (${I.percentage}%). ĞœĞ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ ÑĞ²ÑĞ·Ğ°Ğ½Ñ‹ Ñ ` +
        "Ğ½ĞµĞ²Ğ½Ğ¸Ğ¼Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒÑ Ğ¸Ğ»Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼Ğ¸ Ğ½ĞµĞ¹Ñ€Ğ¾Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚ÑĞ¼Ğ¸, Ğ° Ğ½Ğµ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ Ñ€Ğ°ÑÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾Ğ¼ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ.",
      confidence: "low"
    });
  }

  // DCD
  const J = scales.J;
  if (isAboveThreshold(J.zone.key)) {
    results.push({
      type: "dcd",
      title: "DCD / Ğ”Ğ¸ÑĞ¿Ñ€Ğ°ĞºÑĞ¸Ñ",
      text: `Ğ¢Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚Ğ¸ Ñ ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ†Ğ¸ĞµĞ¹ Ğ¸ Ğ¼Ğ¾Ñ‚Ğ¾Ñ€Ğ¸ĞºĞ¾Ğ¹ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ñ‹ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ (${J.percentage}%). ` +
        "Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ Ğ¾Ñ†ĞµĞ½ĞºĞ° ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸ÑÑ‚Ğ¾Ğ¼.",
      confidence: J.zone.key === "red" ? "high" : "moderate"
    });
  } else if (J.zone.key === "yellow") {
    results.push({
      type: "dcd",
      title: "Ğ”Ğ¸ÑĞ¿Ñ€Ğ°ĞºÑĞ¸Ñ â€” ÑÑƒĞ±ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ‡ĞµÑ€Ñ‚Ñ‹",
      text: `ĞÑ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¼Ğ¾Ñ‚Ğ¾Ñ€Ğ½Ñ‹Ğµ Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚Ğ¸ (${J.percentage}%). ĞœĞ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ ÑĞ²ÑĞ·Ğ°Ğ½Ñ‹ Ñ ` +
        "Ğ½ĞµĞ²Ğ½Ğ¸Ğ¼Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒÑ Ğ¸Ğ»Ğ¸ ÑĞµĞ½ÑĞ¾Ñ€Ğ½Ñ‹Ğ¼Ğ¸ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑĞ¼Ğ¸.",
      confidence: "low"
    });
  }

  return results;
}

// --- ĞšĞ¾Ğ¼Ğ¾Ñ€Ğ±Ğ¸Ğ´Ğ½Ğ¾ÑÑ‚ÑŒ ---

function interpretComorbidity(scales) {
  const results = [];
  const A = scales.A;
  const B = scales.B;
  const D = scales.D;
  const E = scales.E;
  const H = scales.H;

  // Ğ¡Ğ”Ğ’Ğ“ + Ğ ĞĞ¡
  const adhdPresent = isAboveThreshold(A.zone.key) || isAboveThreshold(B.zone.key);
  const asdPresent = isAboveThreshold(D.zone.key) && isAboveThreshold(E.zone.key);

  if (adhdPresent && asdPresent) {
    results.push({
      title: "Ğ’ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ¾Ñ€Ğ±Ğ¸Ğ´Ğ½Ğ¾ÑÑ‚ÑŒ: Ğ¡Ğ”Ğ’Ğ“ + Ğ ĞĞ¡",
      text: "ĞĞ±Ğ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ñ‹ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾. DSM-5 (Ñ 2013 Ğ³Ğ¾Ğ´Ğ°) Ğ´Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½ÑƒÑ " +
        "Ğ¿Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºÑƒ Ğ¾Ğ±Ğ¾Ğ¸Ñ… Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾Ğ·Ğ¾Ğ². Ğ˜ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑƒĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ Ğ½Ğ° Ğ¿ĞµÑ€ĞµÑĞµÑ‡ĞµĞ½Ğ¸Ğµ Ğ² 30â€“80% ÑĞ»ÑƒÑ‡Ğ°ĞµĞ² " +
        "(Rommelse et al., 2010).",
      interactions: [
        {
          title: "ĞŸÑ€Ğ¾Ñ‚Ğ¸Ğ²Ğ¾Ñ€ĞµÑ‡Ğ¸Ğµ Ñ€ÑƒÑ‚Ğ¸Ğ½Ñ‹",
          text: "Ğ¡Ğ”Ğ’Ğ“ ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ñ…Ğ°Ğ¾Ñ Ğ¸ Ğ´ĞµĞ·Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ, Ğ ĞĞ¡ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞ° Ğ¸ Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·ÑƒĞµĞ¼Ğ¾ÑÑ‚Ğ¸. " +
            "Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº Ğ½ÑƒĞ¶Ğ´Ğ°ĞµÑ‚ÑÑ Ğ² Ñ€ÑƒÑ‚Ğ¸Ğ½Ğµ, Ğ½Ğ¾ Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ ĞµÑ‘ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ."
        },
        {
          title: "ĞŸĞ°Ñ€Ğ°Ğ´Ğ¾ĞºÑ ÑÑ‚Ğ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ğ¸",
          text: "Ğ¡Ğ”Ğ’Ğ“ ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Â«Ğ³Ğ¾Ğ»Ğ¾Ğ´Â» Ğ´Ğ¾ ÑÑ‚Ğ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ğ¸, Ğ ĞĞ¡ â€” Ğ¿ĞµÑ€ĞµĞ³Ñ€ÑƒĞ·ĞºÑƒ Ğ¾Ñ‚ Ğ½ĞµÑ‘. " +
            "Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: Ğ¾Ñ‡ĞµĞ½ÑŒ ÑƒĞ·ĞºĞ¸Ğ¹ Â«ĞºĞ¾Ñ€Ğ¸Ğ´Ğ¾Ñ€Â» ĞºĞ¾Ğ¼Ñ„Ğ¾Ñ€Ñ‚Ğ½Ğ¾Ğ¹ ÑÑ‚Ğ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ğ¸."
        },
        {
          title: "Ğ”Ğ²Ğ¾Ğ¹Ğ½Ğ°Ñ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ² Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸",
          text: "Ğ¡Ğ”Ğ’Ğ“: Ğ¿ĞµÑ€ĞµĞ±Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ, Ğ¿Ğ¾Ñ‚ĞµÑ€Ñ Ğ½Ğ¸Ñ‚Ğ¸. Ğ ĞĞ¡: Ğ½ĞµĞ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ ÑĞ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ². " +
            "Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ¾Ğ³Ñ€Ğ¾Ğ¼Ğ½Ñ‹Ñ… Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ² Ğ¿Ğ¾ Ğ¾Ğ±Ğ¾Ğ¸Ğ¼ Ñ„Ñ€Ğ¾Ğ½Ñ‚Ğ°Ğ¼."
        }
      ]
    });
  }

  // Ğ¡Ğ”Ğ’Ğ“ + Ğ”Ğ¸ÑĞ»ĞµĞºÑĞ¸Ñ
  if (adhdPresent && isAboveThreshold(H.zone.key)) {
    results.push({
      title: "Ğ’ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ¾Ñ€Ğ±Ğ¸Ğ´Ğ½Ğ¾ÑÑ‚ÑŒ: Ğ¡Ğ”Ğ’Ğ“ + Ğ”Ğ¸ÑĞ»ĞµĞºÑĞ¸Ñ",
      text: "ĞĞ±Ğ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¸ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚. Ğ’ÑÑ‚Ñ€ĞµÑ‡Ğ°ĞµÑ‚ÑÑ Ñƒ ~40% Ğ»ÑĞ´ĞµĞ¹ Ñ Ğ¡Ğ”Ğ’Ğ“ (Germano et al., 2010). " +
        "Ğ¢Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ Ğ¼Ğ¾Ğ³ÑƒÑ‚ ÑƒÑĞ¸Ğ»Ğ¸Ğ²Ğ°Ñ‚ÑŒÑÑ Ğ½ĞµĞ²Ğ½Ğ¸Ğ¼Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒÑ, Ğ¸ Ğ½Ğ°Ğ¾Ğ±Ğ¾Ñ€Ğ¾Ñ‚.",
      interactions: []
    });
  }

  return results;
}

// --- Ğ¡Ğ²Ğ¾Ğ´ĞºĞ° ---

function generateSummary(interp, scales) {
  const parts = [];
  const K = scales.K;
  const N = scales.N;
  const M = scales.M;

  // Ğ¡Ğ”Ğ’Ğ“
  if (interp.adhd.present) {
    parts.push(interp.adhd.title + ` (ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ ÑĞºÑ€Ğ¸Ğ½Ğ¸Ğ½Ğ³Ğ°: ${getConfidenceLabel(interp.adhd.confidence)})`);
  }

  // Ğ ĞĞ¡
  if (interp.asd.present) {
    parts.push(interp.asd.title + ` (ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ ÑĞºÑ€Ğ¸Ğ½Ğ¸Ğ½Ğ³Ğ°: ${getConfidenceLabel(interp.asd.confidence)})`);
  }

  // Ğ Ğ°ÑÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ
  for (const item of interp.learning) {
    if (item.confidence !== "low") {
      parts.push(item.title);
    }
  }

  // ĞšĞ¾Ğ¼Ğ¾Ñ€Ğ±Ğ¸Ğ´Ğ½Ğ¾ÑÑ‚ÑŒ
  if (interp.comorbidity.length > 0) {
    parts.push("Ğ’ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ° ĞºĞ¾Ğ¼Ğ¾Ñ€Ğ±Ğ¸Ğ´Ğ½Ğ¾ÑÑ‚ÑŒ (ÑĞ¾Ñ‡ĞµÑ‚Ğ°Ğ½Ğ¸Ğµ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¹)");
  }

  // Ğ¥Ñ€Ğ¾Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑĞºĞ¾Ñ€ÑŒ
  if (K.zone.key === "high") {
    parts.push("Ğ¢Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¿Ñ€Ğ¸ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ Ñ Ğ´ĞµÑ‚ÑÑ‚Ğ²Ğ° (Ñ…Ñ€Ğ¾Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑĞºĞ¾Ñ€ÑŒ: ÑĞ¸Ğ»ÑŒĞ½Ñ‹Ğ¹)");
  } else if (K.zone.key === "low") {
    parts.push("âš ï¸ Ğ¥Ñ€Ğ¾Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑĞºĞ¾Ñ€ÑŒ ÑĞ»Ğ°Ğ±Ñ‹Ğ¹ â€” Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ¾Ğ±Ñ€ĞµÑ‚Ñ‘Ğ½Ğ½Ñ‹Ğ¼Ğ¸");
  }

  // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ²Ğ»Ğ¸ÑĞ½Ğ¸Ğµ
  if (N.sum >= 11) {
    parts.push("Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ²Ğ»Ğ¸ÑĞ½Ğ¸Ğµ: Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ");
  } else if (N.sum >= 6) {
    parts.push("Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ²Ğ»Ğ¸ÑĞ½Ğ¸Ğµ: ÑƒĞ¼ĞµÑ€ĞµĞ½Ğ½Ğ¾Ğµ");
  }

  // ĞÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ğ½
  if (M.sum <= 8) {
    parts.push("Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ Ğ°Ñ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ â€” Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¾Ñ‚Ñ€Ğ°Ğ¶Ğ°ÑÑ‚ ÑƒÑÑ‚Ğ¾Ğ¹Ñ‡Ğ¸Ğ²Ñ‹Ğµ Ñ‡ĞµÑ€Ñ‚Ñ‹");
  }

  if (parts.length === 0) {
    return "ĞŸĞ¾ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°Ğ¼ ÑĞºÑ€Ğ¸Ğ½Ğ¸Ğ½Ğ³Ğ° Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ¾Ğ² Ğ½ĞµĞ¹Ñ€Ğ¾Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ½Ğµ Ğ²Ñ‹ÑĞ²Ğ»ĞµĞ½Ğ¾.";
  }

  return parts.join(".\n") + ".";
}

// ------------------------------------------------------------
// 6. Ğ¤Ğ›ĞĞ“Ğ˜
// ------------------------------------------------------------

function generateFlags(scales) {
  const flags = [];
  const G = scales.G;
  const M = scales.M;
  const K = scales.K;
  const L = scales.L;
  const N = scales.N;
  const A = scales.A;
  const C = scales.C;
  const D = scales.D;

  // Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ ĞºĞ°Ğ¼ÑƒÑ„Ğ»ÑĞ¶
  if (G.zone.key === "orange" || G.zone.key === "red") {
    flags.push({
      icon: "ğŸ­",
      title: "Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ ĞºĞ°Ğ¼ÑƒÑ„Ğ»ÑĞ¶",
      text: `Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ¼Ğ°ÑĞºĞ¸Ğ½Ğ³Ğ°: ${G.percentage}%. Ğ’Ğ°ÑˆĞ¸ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½ĞµĞµ, ` +
        "Ñ‡ĞµĞ¼ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ÑˆĞºĞ°Ğ»Ñ‹. Ğ’Ñ‹ Ğ·Ğ°Ñ‚Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚Ğµ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹ Ğ½Ğ° Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ " +
        "Â«Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾Â» Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ°, Ñ‡Ñ‚Ğ¾ ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ¼ Ñ…Ñ€Ğ¾Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ¸ÑÑ‚Ğ¾Ñ‰ĞµĞ½Ğ¸Ñ."
    });
  }

  // Ğ’Ñ‹Ğ³Ğ¾Ñ€Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚ Ğ¼Ğ°ÑĞºĞ¸Ğ½Ğ³Ğ°
  if ((G.zone.key === "orange" || G.zone.key === "red") && M.sum >= 9) {
    flags.push({
      icon: "ğŸ”¥",
      title: "Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾Ğµ Ğ²Ñ‹Ğ³Ğ¾Ñ€Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚ Ğ¼Ğ°ÑĞºĞ¸Ğ½Ğ³Ğ°",
      text: "Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ ĞºĞ°Ğ¼ÑƒÑ„Ğ»ÑĞ¶ ÑĞ¾Ñ‡ĞµÑ‚Ğ°ĞµÑ‚ÑÑ Ñ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ½Ñ‹Ğ¼ Ğ°Ñ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¼ Ñ„Ğ¾Ğ½Ğ¾Ğ¼. Ğ’Ğ°ÑˆĞµ Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ " +
        "ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ ÑĞ²ÑĞ·Ğ°Ğ½Ğ¾ Ñ Ğ¸ÑÑ‚Ğ¾Ñ‰ĞµĞ½Ğ¸ĞµĞ¼ Ğ¾Ñ‚ Ğ¿Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ°Ğ¼ÑƒÑ„Ğ»ÑĞ¶Ğ° " +
        "(Ğ°ÑƒÑ‚Ğ¸ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ²Ñ‹Ğ³Ğ¾Ñ€Ğ°Ğ½Ğ¸Ğµ / burnout)."
    });
  }

  // ĞŸĞ°Ñ€Ğ°Ğ´Ğ¾ĞºÑ ÑÑ‚Ğ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ğ¸ (Ğ¡Ğ”Ğ’Ğ“ + Ğ ĞĞ¡)
  const adhdPresent = isAboveThreshold(A.zone.key) || isAboveThreshold(scales.B.zone.key);
  const sensoryHigh = scales.F.zone.key === "orange" || scales.F.zone.key === "red";
  if (adhdPresent && sensoryHigh) {
    flags.push({
      icon: "âš¡",
      title: "ĞŸĞ°Ñ€Ğ°Ğ´Ğ¾ĞºÑ ÑÑ‚Ğ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ğ¸",
      text: "Ğ’Ğ°Ñˆ Ğ¼Ğ¾Ğ·Ğ³ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ Â«Ğ³Ğ¾Ğ»Ğ¾Ğ´ĞµĞ½Â» Ğ´Ğ¾ ÑÑ‚Ğ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ğ¸ (Ğ¡Ğ”Ğ’Ğ“) Ğ¸ Ğ¿ĞµÑ€ĞµĞ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ÑÑ ĞµÑ " +
        "(ÑĞµĞ½ÑĞ¾Ñ€Ğ½Ğ°Ñ Ğ³Ğ¸Ğ¿ĞµÑ€Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ). Ğ­Ñ‚Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ ÑƒĞ·ĞºĞ¸Ğ¹ Â«ĞºĞ¾Ñ€Ğ¸Ğ´Ğ¾Ñ€ ĞºĞ¾Ğ¼Ñ„Ğ¾Ñ€Ñ‚Ğ°Â» Ğ¸ " +
        "Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ¼ Ñ…Ñ€Ğ¾Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ ÑÑ‚Ñ€ĞµÑÑĞ°."
    });
  }

  // Ğ¡Ğ»Ğ°Ğ±Ñ‹Ğ¹ Ñ…Ñ€Ğ¾Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑĞºĞ¾Ñ€ÑŒ
  if (K.zone.key === "low") {
    flags.push({
      icon: "ğŸ“…",
      title: "Ğ¡Ğ»Ğ°Ğ±Ñ‹Ğ¹ Ñ…Ñ€Ğ¾Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑĞºĞ¾Ñ€ÑŒ",
      text: "ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ½Ñ‹Ğµ Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚Ğ¸, Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, Ğ½Ğµ Ğ¿Ñ€Ğ¸ÑÑƒÑ‚ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ»Ğ¸ Ñ Ğ´ĞµÑ‚ÑÑ‚Ğ²Ğ°. ĞĞ½Ğ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ " +
        "Ğ¿Ñ€Ğ¸Ğ¾Ğ±Ñ€ĞµÑ‚Ñ‘Ğ½Ğ½Ñ‹Ğ¼Ğ¸ (ÑÑ‚Ñ€ĞµÑÑ, Ğ²Ñ‹Ğ³Ğ¾Ñ€Ğ°Ğ½Ğ¸Ğµ, Ñ‚Ñ€Ğ°Ğ²Ğ¼Ğ°, ÑĞ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ·Ğ°Ğ±Ğ¾Ğ»ĞµĞ²Ğ°Ğ½Ğ¸Ğµ), " +
        "Ğ° Ğ½Ğµ Ğ¾Ñ‚Ñ€Ğ°Ğ¶Ğ°Ñ‚ÑŒ Ğ½ĞµĞ¹Ñ€Ğ¾Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ. ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾ Ğ¾Ğ±ÑÑƒĞ´Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ¾ ÑĞ¾ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸ÑÑ‚Ğ¾Ğ¼."
    });
  }

  // Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ° Ñ‚Ñ€Ğ°Ğ²Ğ¼Ğ°
  if (K.zone.key === "low" && M.sum >= 9 &&
      (isAboveThreshold(D.zone.key) || isAboveThreshold(C.zone.key))) {
    flags.push({
      icon: "ğŸ’”",
      title: "Ğ Ğ°ÑÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ²Ğ»Ğ¸ÑĞ½Ğ¸Ğµ Ñ‚Ñ€Ğ°Ğ²Ğ¼Ñ‹",
      text: "Ğ¡Ğ¾Ñ‡ĞµÑ‚Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ½Ñ‹Ñ… ÑˆĞºĞ°Ğ» ÑĞ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚ĞµĞ¹ Ğ¸/Ğ¸Ğ»Ğ¸ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ´Ğ¸ÑÑ€ĞµĞ³ÑƒĞ»ÑÑ†Ğ¸Ğ¸ " +
        "Ğ¿Ñ€Ğ¸ ÑĞ»Ğ°Ğ±Ğ¾Ğ¼ Ñ…Ñ€Ğ¾Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¼ ÑĞºĞ¾Ñ€Ğµ Ğ¸ Ğ½ĞµÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ°Ñ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¼ Ñ„Ğ¾Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ ÑƒĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ " +
        "Ğ½Ğ° ĞºĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑĞ½ÑƒÑ Ñ‚Ñ€Ğ°Ğ²Ğ¼Ñƒ (ĞšĞŸĞ¢Ğ¡Ğ ), Ğ° Ğ½Ğµ Ğ½ĞµĞ¹Ñ€Ğ¾Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ. Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ " +
        "Ğ´Ğ¸Ñ„Ñ„ĞµÑ€ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° ÑĞ¾ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸ÑÑ‚Ğ¾Ğ¼."
    });
  }

  // Ğ¡Ğ”Ğ’Ğ“ + Ñ‚Ñ€ĞµĞ²Ğ¾Ğ³Ğ°
  if (C.subscales.ADHD_ANX && C.subscales.ADHD_ANX.percentage >= 60 && M.sum <= 8) {
    flags.push({
      icon: "ğŸ”„",
      title: "Ğ¡Ğ”Ğ’Ğ“-Ğ¾Ğ±ÑƒÑĞ»Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ğ°Ñ Ñ‚Ñ€ĞµĞ²Ğ¾Ğ³Ğ°",
      text: "Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ Ğ¡Ğ”Ğ’Ğ“-Ñ‚Ñ€ĞµĞ²Ğ¾Ğ³Ğ° Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ¾Ğ±Ñ‰ĞµĞ¼ Ğ°Ñ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¼ Ñ„Ğ¾Ğ½Ğµ. Ğ¢Ñ€ĞµĞ²Ğ¾Ğ³Ğ°, Ğ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾, " +
        "Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‡Ğ½Ğ° Ğ¿Ğ¾ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ Ğº Ğ¡Ğ”Ğ’Ğ“ (ĞºĞ¾Ğ¼Ğ¿ĞµĞ½ÑĞ°Ñ‚Ğ¾Ñ€Ğ½Ğ°Ñ). Ğ’Ğ°Ğ¶Ğ½Ğ¾ Ğ½Ğµ Ğ¿ÑƒÑ‚Ğ°Ñ‚ÑŒ Ñ Ğ¿ĞµÑ€Ğ²Ğ¸Ñ‡Ğ½Ñ‹Ğ¼ " +
        "Ñ‚Ñ€ĞµĞ²Ğ¾Ğ¶Ğ½Ñ‹Ğ¼ Ñ€Ğ°ÑÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾Ğ¼ â€” Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ Ğº Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰Ğ¸ Ğ±ÑƒĞ´ĞµÑ‚ Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ°Ñ‚ÑŒÑÑ."
    });
  }

  // Ğ“Ğ¸Ğ¿ĞµÑ€ĞºĞ¾Ğ¼Ğ¿ĞµĞ½ÑĞ°Ñ†Ğ¸Ñ
  if (L.sum <= 7 && N.sum >= 6 && K.zone.key === "high") {
    const anyMainHigh = Object.entries(scales).some(([key, s]) =>
      s.category === "main" && (s.zone.key === "orange" || s.zone.key === "red")
    );
    if (anyMainHigh) {
      flags.push({
        icon: "ğŸ›¡ï¸",
        title: "ĞšĞ¾Ğ¼Ğ¿ĞµĞ½ÑĞ°Ñ‚Ğ¾Ñ€Ğ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸",
        text: "Ğ’Ñ‹, Ğ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾, Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ»Ğ¸ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸ Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ¿ĞµĞ½ÑĞ°Ñ†Ğ¸Ğ¸ ÑĞ²Ğ¾Ğ¸Ñ… Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚ĞµĞ¹ " +
          "(ÑĞ¿Ğ¸ÑĞºĞ¸, Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ, Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°, Ğ¸Ğ·Ğ±ĞµĞ³Ğ°Ğ½Ğ¸Ğµ). Ğ­Ñ‚Ğ¾ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ, " +
          "Ğ½Ğ¾ Ğ½Ğµ ÑƒÑÑ‚Ñ€Ğ°Ğ½ÑĞµÑ‚ ÑĞ°Ğ¼Ñƒ Ğ½ĞµĞ¹Ñ€Ğ¾Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¸ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ¿Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ñ‹Ñ… ÑƒÑĞ¸Ğ»Ğ¸Ğ¹."
      });
    }
  }

  return flags;
}

// ------------------------------------------------------------
// 7. Ğ Ğ•ĞšĞĞœĞ•ĞĞ”ĞĞ¦Ğ˜Ğ˜
// ------------------------------------------------------------

function generateRecommendations(results) {
  const recs = {
    doList: [],
    dontList: [],
    specialistNotes: []
  };

  const scales = results.scales;
  const interp = results.interpretation;

  // Ğ§Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ
  const anySignificant = Object.entries(scales).some(([key, s]) =>
    s.category === "main" && (s.zone.key === "orange" || s.zone.key === "red")
  );

  if (anySignificant) {
    recs.doList.push("ĞĞ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒÑÑ Ğº Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€Ñƒ Ğ¸/Ğ¸Ğ»Ğ¸ ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¼Ñƒ Ğ¿ÑĞ¸Ñ…Ğ¾Ğ»Ğ¾Ğ³Ñƒ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ†ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ğ¾Ñ†ĞµĞ½ĞºĞ¸");
  }

  if (interp.adhd.present && interp.asd.present) {
    recs.doList.push("ĞŸĞ¾Ğ¿Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸ÑÑ‚Ğ° Ğ¾Ñ†ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¾Ğ±Ğ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ â€” Ğ¡Ğ”Ğ’Ğ“ Ğ¸ Ğ ĞĞ¡ â€” Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾, Ñ‚Ğ°Ğº ĞºĞ°Ğº Ğ¾Ğ½Ğ¸ Ñ‡Ğ°ÑÑ‚Ğ¾ ÑĞ¾ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‚");
  } else if (interp.adhd.present) {
    recs.doList.push("ĞŸĞ¾Ğ¿Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸ÑÑ‚Ğ° Ğ¾Ñ†ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¡Ğ”Ğ’Ğ“, Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚");
  } else if (interp.asd.present) {
    recs.doList.push("ĞŸĞ¾Ğ¿Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸ÑÑ‚Ğ° Ğ¾Ñ†ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€Ğ°ÑÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾ Ğ°ÑƒÑ‚Ğ¸ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ ÑĞ¿ĞµĞºÑ‚Ñ€Ğ°");
  }

  if (interp.learning.some(l => l.confidence !== "low")) {
    recs.doList.push("Ğ Ğ°ÑÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ½ĞµĞ¹Ñ€Ğ¾Ğ¿ÑĞ¸Ñ…Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ¸ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ñ€Ğ°ÑÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ² Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ");
  }

  if (scales.G.zone.key === "orange" || scales.G.zone.key === "red") {
    recs.doList.push("ĞĞ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒ Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸ÑÑ‚Ğ° Ğ½Ğ° Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ ĞºĞ°Ğ¼ÑƒÑ„Ğ»ÑĞ¶ â€” Ğ¾Ğ½ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ·Ğ°Ğ½Ğ¸Ğ¶Ğ°Ñ‚ÑŒ ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºÑƒÑ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½Ñƒ Ğ¿Ñ€Ğ¸ Ğ½Ğ°Ğ±Ğ»ÑĞ´ĞµĞ½Ğ¸Ğ¸");
  }

  recs.doList.push("Ğ’Ğ·ÑÑ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ ÑÑ‚Ğ¾Ğ³Ğ¾ ÑĞºÑ€Ğ¸Ğ½Ğ¸Ğ½Ğ³Ğ° (PDF) Ğ½Ğ° Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ Ğº ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸ÑÑ‚Ñƒ Ğ´Ğ»Ñ Ğ¾Ğ±ÑÑƒĞ¶Ğ´ĞµĞ½Ğ¸Ñ");

  // Ğ§ĞµĞ³Ğ¾ Ğ½Ğµ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ
  recs.dontList.push("ĞĞµ ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞµĞ±Ğµ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾Ğ· Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¸ ÑÑ‚Ğ¾Ğ³Ğ¾ Ñ‚ĞµÑÑ‚Ğ°");
  recs.dontList.push("ĞĞµ Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°Ñ‚ÑŒ ÑĞ°Ğ¼Ğ¾Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ (Ğ² Ñ‚Ğ¾Ğ¼ Ñ‡Ğ¸ÑĞ»Ğµ Ğ¼ĞµĞ´Ğ¸ĞºĞ°Ğ¼ĞµĞ½Ñ‚Ğ¾Ğ·Ğ½Ğ¾Ğµ)");
  recs.dontList.push("ĞĞµ Ğ¾Ñ‚Ñ‡Ğ°Ğ¸Ğ²Ğ°Ñ‚ÑŒÑÑ â€” Ğ½ĞµĞ¹Ñ€Ğ¾Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ ÑÑ‚Ğ¾ Ğ½Ğµ Ğ±Ğ¾Ğ»ĞµĞ·Ğ½ÑŒ, Ğ° Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ Ğ½ĞµĞ¹Ñ€Ğ¾ĞºĞ¾Ğ³Ğ½Ğ¸Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ");
  recs.dontList.push("ĞĞµ Ğ¾Ğ±ĞµÑÑ†ĞµĞ½Ğ¸Ğ²Ğ°Ñ‚ÑŒ ÑĞ²Ğ¾Ğ¸ Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚Ğ¸ â€” Â«Ğ²ÑĞµ Ğ¸Ğ½Ğ¾Ğ³Ğ´Ğ° Ğ¾Ñ‚Ğ²Ğ»ĞµĞºĞ°ÑÑ‚ÑÑÂ» Ğ½Ğµ Ğ¾Ğ·Ğ½Ğ°Ñ‡Ğ°ĞµÑ‚, Ñ‡Ñ‚Ğ¾ Ğ²Ğ°Ñˆ Ğ¾Ğ¿Ñ‹Ñ‚ Ğ½Ğµ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ğ¼");

  // Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ¸ Ğ´Ğ»Ñ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸ÑÑ‚Ğ°
  if (interp.adhd.present) {
    recs.specialistNotes.push(`Ğ¡Ğ”Ğ’Ğ“-ÑĞºÑ€Ğ¸Ğ½Ğ¸Ğ½Ğ³: ${interp.adhd.title} (A=${scales.A.percentage}%, B=${scales.B.percentage}%)`);
  }

  if (interp.asd.present) {
    recs.specialistNotes.push(`Ğ ĞĞ¡-ÑĞºÑ€Ğ¸Ğ½Ğ¸Ğ½Ğ³: D=${scales.D.percentage}%, E=${scales.E.percentage}%, F=${scales.F.percentage}%`);
  }

  if (scales.G.zone.key === "orange" || scales.G.zone.key === "red") {
    recs.specialistNotes.push(`ĞšĞ°Ğ¼ÑƒÑ„Ğ»ÑĞ¶: ${scales.G.percentage}% â€” ÑƒÑ‡ĞµÑÑ‚ÑŒ Ğ¿Ñ€Ğ¸ ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¼ Ğ½Ğ°Ğ±Ğ»ÑĞ´ĞµĞ½Ğ¸Ğ¸`);
  }

  if (scales.C.subscales.RSD && scales.C.subscales.RSD.percentage >= 60) {
    recs.specialistNotes.push(`RSD: ${scales.C.subscales.RSD.percentage}% â€” Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ğ°Ñ Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğº Ğ¾Ñ‚Ğ²ĞµÑ€Ğ¶ĞµĞ½Ğ¸Ñ`);
  }

  if (scales.C.subscales.ADHD_ANX && scales.C.subscales.ADHD_ANX.percentage >= 60 && scales.M.sum <= 8) {
    recs.specialistNotes.push("Ğ¢Ñ€ĞµĞ²Ğ¾Ğ³Ğ° Ğ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾ Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‡Ğ½Ğ° Ğ¿Ğ¾ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ Ğº Ğ¡Ğ”Ğ’Ğ“ (ĞºĞ¾Ğ¼Ğ¿ĞµĞ½ÑĞ°Ñ‚Ğ¾Ñ€Ğ½Ğ°Ñ), Ğ½Ğµ Ğ“Ğ¢Ğ ");
  }

  if (scales.K.zone.key === "low") {
    recs.specialistNotes.push("Ğ¡Ğ»Ğ°Ğ±Ñ‹Ğ¹ Ñ…Ñ€Ğ¾Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑĞºĞ¾Ñ€ÑŒ â€” Ñ€Ğ°ÑÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ¾Ğ±Ñ€ĞµÑ‚Ñ‘Ğ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹");
  }

  if (scales.M.sum >= 15) {
    recs.specialistNotes.push(`ĞÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ğ½: ${scales.M.sum}/24 â€” Ğ² Ğ¿ĞµÑ€Ğ²ÑƒÑ Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ Ğ¾Ñ†ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ`);
  }

  return recs;
}

// ------------------------------------------------------------
// 8. Ğ’Ğ¡ĞŸĞĞœĞĞ“ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ«Ğ• Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜
// ------------------------------------------------------------

function isAboveThreshold(zoneKey) {
  return zoneKey === "orange" || zoneKey === "red";
}

function getConfidenceLabel(confidence) {
  switch (confidence) {
    case "high": return "Ğ²Ñ‹ÑĞ¾ĞºĞ°Ñ";
    case "moderate": return "ÑƒĞ¼ĞµÑ€ĞµĞ½Ğ½Ğ°Ñ";
    case "low": return "Ğ½Ğ¸Ğ·ĞºĞ°Ñ";
    default: return "Ğ½Ğµ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ°";
  }
}

// ĞšĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² Ğ² URL-hash
function encodeAnswers(answers) {
  let str = "";
  for (let i = 1; i <= 112; i++) {
    str += (answers[i] !== undefined ? answers[i] : "x");
  }
  return str;
}

// Ğ”ĞµĞºĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² Ğ¸Ğ· URL-hash
function decodeAnswers(hash) {
  const answers = {};
  for (let i = 0; i < hash.length && i < 112; i++) {
    const ch = hash[i];
    if (ch !== "x") {
      answers[i + 1] = parseInt(ch);
    }
  }
  return answers;
}

// Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ‚ĞµĞºÑÑ‚Ğ° Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ Ğ´Ğ»Ñ PDF / ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
function generateProfileText(results) {
  const lines = [];
  const scales = results.scales;

  lines.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
  lines.push("           ĞŸĞ ĞĞ¤Ğ˜Ğ›Ğ¬ Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢ĞĞ’ Ğ¡ĞĞĞ’-112");
  lines.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
  lines.push("");
  lines.push(`Ğ”Ğ°Ñ‚Ğ°: ${new Date().toLocaleDateString("ru-RU")}`);
  lines.push("");

  // ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒĞ½Ñ‹Ğµ
  lines.push("â”€â”€ ĞšĞĞĞ¢Ğ ĞĞ›Ğ¬ĞĞ«Ğ• ĞŸĞĞ ĞĞœĞ•Ğ¢Ğ Ğ« â”€â”€");
  lines.push("");
  lines.push(`Ğ”Ğ¾ÑÑ‚Ğ¾Ğ²ĞµÑ€Ğ½Ğ¾ÑÑ‚ÑŒ (L):       ${scales.L.sum}/${scales.L.max}  ${scales.L.zone.icon} ${scales.L.zone.label}`);
  lines.push(`ĞÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ğ½ (M):     ${scales.M.sum}/${scales.M.max}  ${scales.M.zone.icon} ${scales.M.zone.label}`);
  lines.push(`Ğ¥Ñ€Ğ¾Ğ½Ğ¾Ğ»Ğ¾Ğ³. ÑĞºĞ¾Ñ€ÑŒ (K):     ${scales.K.sum}/${scales.K.max}  ${scales.K.zone.icon} ${scales.K.zone.label}`);
  lines.push(`Ğ¤ÑƒĞ½ĞºÑ†. Ğ²Ğ»Ğ¸ÑĞ½Ğ¸Ğµ (N):      ${scales.N.sum}/${scales.N.max}  ${scales.N.zone.icon} ${scales.N.zone.label}`);
  lines.push("");

  // ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ÑˆĞºĞ°Ğ»Ñ‹
  lines.push("â”€â”€ ĞĞ¡ĞĞĞ’ĞĞ«Ğ• Ğ¨ĞšĞĞ›Ğ« â”€â”€");
  lines.push("");

  const mainScales = Object.entries(scales).filter(([k, s]) => s.category === "main");
  for (const [key, s] of mainScales) {
    const bar = makeBar(s.percentage);
    lines.push(`${s.shortName}:`);
    lines.push(`  ${s.sum}/${s.max}  ${s.percentage}%  ${bar}  ${s.zone.icon} ${s.zone.label}`);

    // Ğ¡ÑƒĞ±-ÑˆĞºĞ°Ğ»Ñ‹
    for (const [subKey, sub] of Object.entries(s.subscales)) {
      const subBar = makeBar(sub.percentage);
      lines.push(`    â””â”€ ${sub.shortName}: ${sub.sum}/${sub.max}  ${sub.percentage}%  ${subBar}  ${sub.zone.icon}`);
    }
  }

  lines.push("");

  // Ğ˜Ğ½Ñ‚ĞµÑ€Ğ¿Ñ€ĞµÑ‚Ğ°Ñ†Ğ¸Ñ
  lines.push("â”€â”€ Ğ˜ĞĞ¢Ğ•Ğ ĞŸĞ Ğ•Ğ¢ĞĞ¦Ğ˜Ğ¯ â”€â”€");
  lines.push("");
  lines.push(results.interpretation.summary);
  lines.push("");

  // Ğ¤Ğ»Ğ°Ğ³Ğ¸
  if (results.flags.length > 0) {
    lines.push("â”€â”€ ĞĞ‘Ğ ĞĞ¢Ğ˜Ğ¢Ğ• Ğ’ĞĞ˜ĞœĞĞĞ˜Ğ• â”€â”€");
    lines.push("");
    for (const flag of results.flags) {
      lines.push(`${flag.icon} ${flag.title}`);
      lines.push(`  ${flag.text}`);
      lines.push("");
    }
  }

  // Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸
  lines.push("â”€â”€ Ğ Ğ•ĞšĞĞœĞ•ĞĞ”ĞĞ¦Ğ˜Ğ˜ â”€â”€");
  lines.push("");
  for (const rec of results.recommendations.doList) {
    lines.push(`âœ… ${rec}`);
  }
  lines.push("");
  for (const rec of results.recommendations.dontList) {
    lines.push(`âŒ ${rec}`);
  }

  if (results.recommendations.specialistNotes.length > 0) {
    lines.push("");
    lines.push("Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ¸ Ğ´Ğ»Ñ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸ÑÑ‚Ğ°:");
    for (const note of results.recommendations.specialistNotes) {
      lines.push(`  â€¢ ${note}`);
    }
  }

  lines.push("");
  lines.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
  lines.push("Ğ¡ĞĞĞ’-112 v1.0 â€” ÑĞºÑ€Ğ¸Ğ½Ğ¸Ğ½Ğ³Ğ¾Ğ²Ñ‹Ğ¹ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚, Ğ½Ğµ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾Ğ·.");
  lines.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");

  return lines.join("\n");
}

function makeBar(percentage) {
  const filled = Math.round(percentage / 5);
  const empty = 20 - filled;
  return "â–ˆ".repeat(filled) + "â–‘".repeat(empty);
}